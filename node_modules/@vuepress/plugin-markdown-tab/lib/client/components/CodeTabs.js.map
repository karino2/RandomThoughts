{"version":3,"file":"CodeTabs.js","sources":["../../../src/client/components/CodeTabs.ts"],"sourcesContent":["import type { RequiredSlot } from '@vuepress/helper/client'\nimport { useStorage } from '@vueuse/core'\nimport type { PropType, SlotsType, VNode } from 'vue'\nimport {\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n  shallowRef,\n  useId,\n  watch,\n} from 'vue'\n\nimport type { TabProps } from './Tabs.js'\n\nimport '../styles/code-tabs.css'\n\nconst CODE_TAB_STORE_NAME = 'VUEPRESS_CODE_TAB_STORE'\n\nconst codeTabStore = useStorage<Record<string, string>>(CODE_TAB_STORE_NAME, {})\n\nexport const CodeTabs = defineComponent({\n  name: 'CodeTabs',\n\n  props: {\n    /**\n     * Active tab index\n     *\n     * 激活的标签页序号\n     */\n    active: {\n      type: Number,\n      default: 0,\n    },\n\n    /**\n     * Code tab data\n     *\n     * 代码标签页数据\n     */\n    data: {\n      type: Array as PropType<TabProps[]>,\n      required: true,\n    },\n\n    /**\n     * Tab id\n     *\n     * 标签页 id\n     */\n    tabId: String,\n  },\n\n  slots: Object as SlotsType<{\n    [slot: `title${number}`]: RequiredSlot<{\n      value: string\n      isActive: boolean\n    }>\n    [slot: `tab${number}`]: RequiredSlot<{\n      value: string\n      isActive: boolean\n    }>\n  }>,\n\n  setup(props, { slots }) {\n    let ids = props.data.map(() => useId())\n\n    // Index of current active item\n    const activeIndex = ref(props.active)\n\n    // Refs of the tab buttons\n    const tabRefs = shallowRef<HTMLUListElement[]>([])\n\n    // Update store\n    const updateStore = (): void => {\n      if (props.tabId)\n        codeTabStore.value[props.tabId] = props.data[activeIndex.value].id\n    }\n\n    // Activate next tab\n    const activateNext = (index = activeIndex.value): void => {\n      activeIndex.value = index < tabRefs.value.length - 1 ? index + 1 : 0\n      tabRefs.value[activeIndex.value].focus()\n    }\n\n    // Activate previous tab\n    const activatePrev = (index = activeIndex.value): void => {\n      activeIndex.value = index > 0 ? index - 1 : tabRefs.value.length - 1\n      tabRefs.value[activeIndex.value].focus()\n    }\n\n    // Handle keyboard event\n    const keyboardHandler = (event: KeyboardEvent, index: number): void => {\n      if (event.key === ' ' || event.key === 'Enter') {\n        event.preventDefault()\n        activeIndex.value = index\n      } else if (event.key === 'ArrowRight') {\n        event.preventDefault()\n        activateNext()\n      } else if (event.key === 'ArrowLeft') {\n        event.preventDefault()\n        activatePrev()\n      }\n\n      if (props.tabId)\n        codeTabStore.value[props.tabId] = props.data[activeIndex.value].id\n    }\n\n    const getInitialIndex = (): number => {\n      if (props.tabId) {\n        const valueIndex = props.data.findIndex(\n          ({ id }) => codeTabStore.value[props.tabId!] === id,\n        )\n\n        if (valueIndex !== -1) return valueIndex\n      }\n\n      return props.active\n    }\n\n    // only update ids in dev mode\n    if (__VUEPRESS_DEV__) {\n      watch(\n        () => props.data.length,\n        () => {\n          ids = props.data.map(() => useId())\n        },\n      )\n    }\n\n    onMounted(() => {\n      activeIndex.value = getInitialIndex()\n\n      watch(\n        () => props.tabId && codeTabStore.value[props.tabId],\n        (newValue, oldValue) => {\n          if (props.tabId && newValue !== oldValue) {\n            const index = props.data.findIndex(({ id }) => id === newValue)\n\n            if (index !== -1) activeIndex.value = index\n          }\n        },\n      )\n    })\n\n    return (): VNode | null =>\n      props.data.length\n        ? h('div', { class: 'vp-code-tabs' }, [\n            h(\n              'div',\n              { class: 'vp-code-tabs-nav', role: 'tablist' },\n              props.data.map(({ id }, index) => {\n                const isActive = index === activeIndex.value\n\n                return h(\n                  'button',\n                  {\n                    'type': 'button',\n                    'ref': (element) => {\n                      if (element)\n                        tabRefs.value[index] = element as HTMLUListElement\n                    },\n                    'class': ['vp-code-tab-nav', { active: isActive }],\n                    'role': 'tab',\n                    'aria-controls': ids[index],\n                    'aria-selected': isActive,\n                    'onClick': () => {\n                      activeIndex.value = index\n                      updateStore()\n                    },\n                    'onKeydown': (event: KeyboardEvent) => {\n                      keyboardHandler(event, index)\n                    },\n                  },\n                  slots[`title${index}`]({ value: id, isActive }),\n                )\n              }),\n            ),\n            props.data.map(({ id }, index) => {\n              const isActive = index === activeIndex.value\n\n              return h(\n                'div',\n                {\n                  'class': ['vp-code-tab', { active: isActive }],\n                  'id': ids[index],\n                  'role': 'tabpanel',\n                  'aria-expanded': isActive,\n                },\n                [\n                  h(\n                    'div',\n                    { class: 'vp-code-tab-title' },\n                    slots[`title${index}`]({ value: id, isActive }),\n                  ),\n                  slots[`tab${index}`]({ value: id, isActive }),\n                ],\n              )\n            }),\n          ])\n        : null\n  },\n})\n"],"names":["CODE_TAB_STORE_NAME","codeTabStore","useStorage","CodeTabs","defineComponent","props","slots","ids","useId","activeIndex","ref","tabRefs","shallowRef","updateStore","activateNext","index","activatePrev","keyboardHandler","event","getInitialIndex","valueIndex","id","watch","onMounted","newValue","oldValue","h","isActive","element"],"mappings":"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"}