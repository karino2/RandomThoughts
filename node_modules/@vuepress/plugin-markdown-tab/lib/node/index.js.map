{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/codeTabs.ts","../../src/node/prepareClientConfigFile.ts","../../src/node/tabs.ts","../../src/node/markdownTabPlugin.ts"],"sourcesContent":["// Single quote will break @vue/compiler-sfc\nexport const stringifyProp = (data: unknown): string =>\n  JSON.stringify(data).replace(/'/g, '&#39')\n","import { tab } from '@mdit/plugin-tab'\nimport type { PluginSimple } from 'markdown-it'\n\nimport { stringifyProp } from './utils.js'\n\n/**\n * Markdown-it plugin for code tabs\n *\n * 用于代码选项卡的 Markdown-it 插件\n */\nexport const codeTabs: PluginSimple = (md) => {\n  tab(md, {\n    name: 'code-tabs',\n\n    openRender: ({ active, data }, tokens, index) => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const { meta } = tokens[index]\n      const titles = data.map(({ title }) => md.renderInline(title))\n      const tabsData = data.map((item, dataIndex) => {\n        const { id = titles[dataIndex] } = item\n\n        return { id }\n      })\n\n      return `<CodeTabs :data='${stringifyProp(tabsData)}'${\n        active === -1 ? '' : ` :active=\"${active}\"`\n      }${\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        meta.id ? ` tab-id=\"${meta.id as string}\"` : ''\n      }>\n${titles\n  .map(\n    (title, titleIndex) => `\\\n<template #title${titleIndex}=\"{ value, isActive }\">${title}</template>\n`,\n  )\n  .join('')}\\\n`\n    },\n\n    closeRender: () => `\\\n</CodeTabs>\n`,\n\n    tabOpenRender: ({ index }, tokens, tokenIndex) => {\n      let foundFence = false\n\n      // Hide all elements excerpt the first fence\n      for (let i = tokenIndex; i < tokens.length; i++) {\n        const { block, type } = tokens[i]\n\n        if (block) {\n          if (type === 'code-tabs_tab_close') break\n\n          if ((type === 'fence' || type === 'import_code') && !foundFence) {\n            foundFence = true\n            continue\n          }\n\n          tokens[i].type = 'code_tab_empty'\n          tokens[i].hidden = true\n        }\n      }\n\n      return `\\\n<template #tab${index}=\"{ value, isActive }\">\n`\n    },\n\n    tabCloseRender: () => `\\\n</template>\n`,\n  })\n}\n","import type { App } from 'vuepress'\nimport { ensureEndingSlash } from 'vuepress/shared'\nimport { getDirname, path } from 'vuepress/utils'\nimport type { MarkdownTabPluginOptions } from './options.js'\n\nconst { url } = import.meta\n\nconst __dirname = getDirname(url)\n\nconst CLIENT_FOLDER = ensureEndingSlash(path.resolve(__dirname, '../client'))\n\nexport const prepareClientConfigFile = (\n  app: App,\n  { codeTabs, tabs }: MarkdownTabPluginOptions,\n): Promise<string> => {\n  const imports = new Set<string>()\n  const enhances = new Set<string>()\n\n  if (codeTabs) {\n    imports.add(\n      `import { CodeTabs } from \"${CLIENT_FOLDER}components/CodeTabs.js\";`,\n    )\n    enhances.add(`app.component(\"CodeTabs\", CodeTabs);`)\n  }\n\n  if (tabs) {\n    imports.add(`import { Tabs } from \"${CLIENT_FOLDER}components/Tabs.js\";`)\n    enhances.add(`app.component(\"Tabs\", Tabs);`)\n  }\n\n  return app.writeTemp(\n    'markdown-tab/config.js',\n    `\\\n${Array.from(imports.values()).join('\\n')}\nimport \"${CLIENT_FOLDER}styles/vars.css\";\n\nexport default {\n  enhance: ({ app }) => {\n${Array.from(enhances.values())\n  .map((line) => `    ${line}`)\n  .join('\\n')}\n  },\n};\n`,\n  )\n}\n","import { tab } from '@mdit/plugin-tab'\nimport type { PluginSimple } from 'markdown-it'\n\nimport { stringifyProp } from './utils.js'\n\n/**\n * Markdown-it plugin for tabs\n *\n * 用于选项卡的 Markdown-it 插件\n */\nexport const tabs: PluginSimple = (md) => {\n  tab(md, {\n    name: 'tabs',\n\n    openRender: ({ active, data }, tokens, index) => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const { meta } = tokens[index]\n      const titles = data.map(({ title }) => md.renderInline(title))\n      const tabsData = data.map((item, dataIndex) => {\n        const { id = titles[dataIndex] } = item\n\n        return { id }\n      })\n\n      return `\\\n<Tabs :data='${stringifyProp(tabsData)}'${\n        active === -1 ? '' : ` :active=\"${active}\"`\n      }${\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        meta.id ? ` tab-id=\"${meta.id as string}\"` : ''\n      }>\n${titles\n  .map(\n    (title, titleIndex) => `\\\n<template #title${titleIndex}=\"{ value, isActive }\">${title}</template>\n`,\n  )\n  .join('')}\\\n`\n    },\n\n    closeRender: () => `\\\n</Tabs>\n`,\n\n    tabOpenRender: ({ index }) =>\n      `\\\n<template #tab${index}=\"{ value, isActive }\">\n`,\n\n    tabCloseRender: () => `\\\n</template>\n`,\n  })\n}\n","import type { Plugin } from 'vuepress/core'\n\nimport { codeTabs } from './codeTabs.js'\nimport type { MarkdownTabPluginOptions } from './options.js'\nimport { prepareClientConfigFile } from './prepareClientConfigFile.js'\nimport { tabs } from './tabs.js'\n\nconst PLUGIN_NAME = '@vuepress/plugin-markdown-tab'\n\n/**\n * Markdown tab plugin\n *\n * Markdown 选项卡插件\n *\n * @param options - Plugin options / 插件选项\n * @returns VuePress plugin / VuePress 插件\n *\n * @example\n * ```ts\n * import { markdownTabPlugin } from '@vuepress/plugin-markdown-tab'\n *\n * export default {\n *   plugins: [\n *     markdownTabPlugin({\n *       codeTabs: true,\n *       tabs: true,\n *     }),\n *   ],\n * }\n * ```\n */\nexport const markdownTabPlugin = (\n  options: MarkdownTabPluginOptions,\n): Plugin => {\n  if (!options.codeTabs && !options.tabs)\n    return {\n      name: PLUGIN_NAME,\n    }\n\n  return {\n    name: PLUGIN_NAME,\n\n    extendsMarkdown: (md) => {\n      if (options.codeTabs) md.use(codeTabs)\n      if (options.tabs) md.use(tabs)\n    },\n\n    clientConfigFile: (app) => prepareClientConfigFile(app, options),\n  }\n}\n"],"names":["stringifyProp","data","codeTabs","md","tab","active","tokens","index","meta","titles","title","tabsData","item","dataIndex","id","titleIndex","tokenIndex","foundFence","i","block","type","url","__dirname","getDirname","CLIENT_FOLDER","ensureEndingSlash","path","prepareClientConfigFile","app","tabs","imports","enhances","line","PLUGIN_NAME","markdownTabPlugin","options"],"mappings":"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"}