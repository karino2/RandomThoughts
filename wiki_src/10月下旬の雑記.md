## 2023-10-21 (土)

波は残らなかったようなので今朝は暇になる。
[[Kotlinリファレンスの和訳]]を進めるなど。

audiobookを聞いたりしつつ、リファレンスの和訳をしたりする。

## 2023-10-22 (日)

朝は[[【書籍】サピエンス全史]]を聞くなど。下巻に入って聞くに堪えない感じでは無くなってきた。

malloc置き換えとして[microsoft/mimalloc: mimalloc is a compact general purpose allocator with excellent performance.](https://github.com/microsoft/mimalloc)を評価していたら、なかなか早くなっている。
ただそのままではこちらの事情で組み込めないケースがあるので、
これが何をやっているか理解したいな。

論文はこれか＞[Mimalloc: Free List Sharding in Action - Microsoft Research](https://www.microsoft.com/en-us/research/publication/mimalloc-free-list-sharding-in-action/)

先週のサーフィンを録画してもらったものを見ているが、結構上手くなってるな、自分。
テイクオフの時に経った時点で腰が高いというか、立ち上がる時にもう腰が高くて上半身が後から立つ感じになっているので、
これを直すのが良さそう。
ちょっと陸トレしてみよう。

mimallocの論文を途中まで読んで、その後コードを少し眺めてみる。thread locla storageにheapオブジェクトみたいなのを置いているが、
これはスレッドが無くなった時にどうなるんだろう？

_mi_thread_doneか。ちょっとこの辺はコード読みページ作るかな？

理解は深まったが、やはり一般的ゆえの面倒さがいろいろあるなぁ。

follyのThreadCachedArenaはなかなか良くできてて、そうそう、こういう感じだよ、ってものなんだがなぁ。
こういうのがサーバーサイド以外でも使えればいいんだけれど。

## 2023-10-23

品川で友人とダベる。採用は雇うなら雇う、雇わないなら雇わないでバシっと言ってあげてよ、みたいな話をするなど。

少し新宿の本屋によってkotlinとかAndroidの本を軽く見たり、最近の関心の並列アロケータについて見るがめぼしいものはなし。
Androidはこれじゃあ駄目だよな、という内容が多く参考にならない。
Kotlinの本は薄くて簡素なので、もうちょっと初心者向けに詳しい方がいいのになぁ、とは思うが、それなりに初学者向けに書かれているものはある。薄い本で頑張ってやるのもできなくは無さそう。

並列アロケータみたいな話は全然無い。
最近はC++の現場と書籍の間の乖離が随分大きくなった気がするがどうだろう？
follyには多くの知見が詰まってるが、それが本棚には無い。

follyのThreadLocalはC++のthread_localと何が違うんだ？と思っていたら、youtubeで解説を見つけた。 [CppCon 2016: David Watson “Experiences with Facebook's C++ library" - YouTube](https://www.youtube.com/watch?v=GDxb21kEthM)

なるほど、メンバ変数で使いたい場合に使えるのか。逆にメンバじゃなくて良ければthread_localでいいんだな。