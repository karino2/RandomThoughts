自分の考えたAndroidアプリのアーキテクチャ。Unix like File And Syncの頭文字をとってUFASアーキテクチャと呼びたい。
ユーファスと読む。

## UFASアーキテクチャで作られたアプリ

- [てきすとでっき](てきすとでっき.md)
- [てきすとTL](てきすとTL.md)
- [PngNote](PngNote.md)
- [TeFWiki](TeFWiki.md)
- [カキオク](カキオク.md)
- [いつなに](いつなに.md)

## 基本的な考え

概ね以下のようなアーキテクチャ

- Unix的なプレーンなファイルをStorage Access Frameworkで保存
- ネットワークのpermissionはアプリには無しで、ローカルに保存し、[Syncthing](Syncthing.md)などのフォルダsyncのアプリでPCと共有

以下この二つの要素を説明していく。

## Unix的なプレーンなファイルをStorage Access Frameworkで

まずアプリのストレージとしてデータベースやdata下をなるべく使わずに、プレーンなファイルとディレクトリをなるべく使う。
テキストならプレーンテキスト、画像ならpngなど、なるべく普通のファイルを使う。

プレーンテキストもjsonなどでは無く、行志向のデータだけを素直にもったもの。
ファイルの中にメタ情報はなるべく入れずに、メタ情報はファイル名やディレクトリ構造になるべく反映させる。

保存はStorage Access Frameworkを使って特別な権限は無しでユーザーにコントロールさせる。

## アプリにネットワークpermissionを持たせないでフォルダsyncアプリを使う

Unix的なプレーンファイルをローカルに保存してフォルダsyncでPCと共有する、これが基本的なUFASアーキテクチャの考えとなる。
このおかげで、アプリ自体はネットワークのコードが必要無い。

このように作る事で最初からオフライン機能が自然と提供でき、セキュアでアプリのメンテナンスも容易で、
バックアップなどの管理も容易になり、新しいデバイスに乗り換える時にも個々のアプリのアカウントの設定などが不要になる。

## 色々なメリット

UFASアーキテクチャには数々のメリットがある。すでにここまでの解説でも幾つか触れたが、以下にまとめてみたい。
なお、いくつかの項目はお互いに関連しているので重複した説明も入ってしまっている。

### アプリのメンテナンスが容易

Androidのアプリはメンテナンスが大変である。Androidのバージョンが変わるごとに多くの変更が必要になって、
何もしてなくてもちゃんと動く事を保証するだけでかなりの労力が必要となる。

その多くはネットワークのコードに起因する。
ネットワークはセキュリティ的にも問題が起きやすい所なので、Androidのバージョンが上がる都度多くの変更がある。
それらに追随してセキュアに保ち続けるのはなかなか大変である。

UFASアーキテクチャならアプリ自体にはネットワークのコードを含まないのでこうしたメンテナンスのコストが無い。
これはAndroidのアプリというメンテナンスが大変な分野において、重要なメリットとなる。

### セキュアに作りやすい

フォルダsyncはやる事が単純であるが故に非常に堅牢に作りやすく、また出来ていると思う。
ネットワークをこのネットワークを専門にしたアプリに任せる、というのは、セキュアなシステムになりやすい。

フォルダsyncはグローバルなインターネットに出る必要が無いようにも設定できるので、
この場合は秘匿したいプライベートなデータをインターネットを通らなく出来、流出のリスクが下がります。
サーバーも不要なため、サーバーをexploitされるリスクもありません。

Storage Access Frameworkもバージョンを重ねた枯れたシステムなのでセキュリティ的にも信頼出来ます。

### 開発がインクリメンタルに行いやすい

Unix的なファイルというものは、スクリプトでの操作が容易だ。だから最初の段階ではとりあえずアプリで保存だけ作ってしまえば、
加工的な事はPCで行う、という分業がやりやすい。

こうした小さなスクリプト群にわかれたシステムが開発やメンテナンスのしやすさに優れて堅牢に作りやすいのは、
クラウドなどの仕事をしている人には広く知られている事と思う。

最初にサーバー側を用意しないで始められるのもUFASアーキテクチャの特徴に思う。
これも最低限動くものを作って、コンセプトの正しさを確認していく事を容易にしていると思う。

Androidのアプリはとりあえず使える所までの敷居が高いと思う。
そこをなるべく低くするのは小さく始めるというソフトウェア開発の原則においてとても重要な事で、
UFASアーキテクチャは最も小さくアプリの開発を始める方法を追及したものと言える。

### アプリごとのアカウントが不要

アプリの数を増やす時に、アカウントの設定というのは大きな手間だ。
スマホなどは定期的に端末を乗り換える、という事が起こるし新たなデバイスが追加される事も多い。

こうした時にアプリごとにアカウントの設定が必要になると、多くのアプリを使うのが面倒になる。

UFASアーキテクチャなら[Syncthing](Syncthing.md)などの設定を一回行えれば、個々のアプリはフォルダを指定するだけで、面倒がない。

### データが長期間安定しやすい

Unix的な哲学にしたがってシンプルに設計したデータフォーマットは、あまり変更の余地が無いくらい単純に出来る事が多い。
そうしたフォーマットは最初に決めたら、割とそのまま変更の必要が無い事も多い。
アプリ自体がどんどん変更されていても、データ自体のフォーマットはそのままになる。

これは元々Unix的な哲学に則ってフォーマットを設計すると、出来る事にかなり制約があるせいでもある。
こうした形に上手く表現出来ない機能はなるべく無くす、という設計圧力がUFASアーキテクチャにはある。

もちろんテキストファイルにjsonを保存するようにするなど、部分的に逸脱すればこれらの制約は回避できる。
その結果としてここで挙げているようなメリットの一部を失う事にもなるが、そうしたトレードオフを意図的に選択出来る、
というのがメリットと言える。

また、プレーンテキストやpngファイルなど自体はかなり安定したフォーマットなので、それが専用のツールが無くとも長期間使えるものである事は期待できる。

## 関連する考え

- [メモアプリ、「てきすとでっき」を作った。その思想など。 - なーんだ、ただの水たまりじゃないか](https://karino2.github.io/2020/12/12/textdeck.html)
- [横着プログラミング 第1回: Unixのメモ技術](http://0xcc.net/unimag/1/)
- [【書籍】TheArtOfUnixProgramming](【書籍】TheArtOfUnixProgramming.md)
- [Unix的GUIツール](Unix的GUIツール.md)
