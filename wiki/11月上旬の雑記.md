## 2022-11-01 (火)

おや、もう11月。まじか。

今週からはWindowsのお仕事なので久しぶりにWindowsの開発環境を整えたりしている。
CMake+Ninja+VSCodeかなぁ、と思いつつ、VSも少し使ってみようかなぁ、とか。

## 2022-11-02 (水)

なんか副反応をやり過ごすべく寝まくっていたら、寝るのと起きるのが2時間くらい遅くなってしまった。明日から前倒しするかなぁ。

## 2022-11-04 (金)

サーフィン、昨日は荒れててあんまり乗れず。今日は着いた時には波が落ちてしまってあまり乗れず、
で2連続でいまいち。健康診断が終わったらまた伊豆行きたいなぁ。

今日はサーフィンから帰ってきてから普通にお仕事。Windows上での環境構築はまぁまぁ出来た。
ついでにWindows上で見つかったバグをいろいろ直す。

## 2022-11-05 (土)

- [Link: Performing Calculations on a GPU - Apple Developer Documentation – 法蓮草の森](https://records.dodgson.org/2022/11/04/link-performing-calculations-on-a-gpu-apple-developer-documentation/)
- [ARM GPU Cores – 法蓮草の森](https://records.dodgson.org/2022/11/04/arm-gpu-cores/)

Metalはプラットフォーム提供者が提供してくれてるがゆえのお手軽さがCUDAよりいいですよ。まぁそれは技術自体の問題では無いのではないか、という話もあるけれど。

なおSMとかの話は自分もそれなりに調べたのだが結局良く分からなんのだが、自分のデバイスだとアプリ側からはスレッドは1024本あるように見えて、
使ってる分には同時に1024本動いていると考えて支障は無い印象。具体的にはいっぱいスレッド動かした方が早い。
自分の手元のiPad ProはARM世代だけど、それでも結構早い。
for文よりもディスパッチの方が早いだけかもしれないけれど、FLOPS単位で限界にチャレンジしない以上、使う側からはその辺は区別のしようが無い感じ。
特定のデバイスで限界を追求するよりは、デバイスのグレードを上げるとちゃんとスケールするとかの方が重要になる気がしていて、その辺はHPCと違う所だなぁ、と思っている。

ハードウェアスペック的には単純に同時に動くハードウェアスレッドの数が知りたい、という気持ちもあるが、ワープ単位でいろいろ隠蔽したりもするのでそういう指標が正しいのかも良く分からず、まぁこの辺はシンプルに何かを知るのは難しいよなぁ、という話もありますね（昔触ってたスパコン用GPGPUはPEが4スレッドx2の構成で同時に動くのは4スレッドだがストールすると後ろの4スレッドになる、とかで、これを4とすべきか8とすべきかは良く分からない所）。

パフォーマンス的にはARM版のiPad Proでも手元のIntel Mac Book Proよりも数倍遅いくらいの速度は出ている模様。使ってる印象では結構早いし（CPUとは段違いに早い）、結構パラレルに動いてくれている気がする。
M1 のMac BookとiPadの比較もそのうちやりたい所。

なお、Metalではローカル変数の配列はレジスタにマップされるようで、例えば

```
   float buf[3*1024];
```

とか(C言語の意味での）ローカル変数で定義すると、自分のARM系のiPad Proだとレジスタ数が足りない、とか言われる。
6kBytesくらいまでは取れた。ARM版もけっこうレジスタたくさんありそう。

AndroidもOpenGL ESまではそれなりに皆が使えるように出来たのに、Computing Shaderが無いのはなんとかして欲しい所ですね〜。
まぁそこまでやる気になるタブレット市場があるのか？と言われると微妙だが、そういう所を整備しないのでそういう市場が無いという話のような気もする。