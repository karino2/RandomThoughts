Unique it, 略してuit。gitを参考に考えたファイル管理システム。
すべてのファイルのハッシュを計算して、ハッシュが一致しているファイルは一つだけ実体を持ち、
重複ファイルを消していくようなシステム。

## リンク

- [karino2/uit: Unique it file sync and manage system.](https://github.com/karino2/uit)
- [FSharp](FSharp.md)
- [自作アプリ](自作アプリ.md)

以下はブログに書いたメモとか作業ログ

- [ぼくのかんがえたさいきょうのファイルsyncシステム - なーんだ、ただの水たまりじゃないか](https://karino2.github.io/2020/11/12/saikyou_file_sync.html)
- [uitに関するメモ その1 - なーんだ、ただの水たまりじゃないか](https://karino2.github.io/2020/12/11/uit_memo_1.html)
- [uitメモ2、ローカルで変更された場合についての考察など - なーんだ、ただの水たまりじゃないか](https://karino2.github.io/2020/12/20/uit_memo_2.html)

## 2022-01-30 現在の課題

いざ使ってみようとすると、どうもバカでかいファイルに一気に処理を走らせる感じになってしまい、
動く気がしなくて気後れてしまう。

一番の問題はuit initが大きく始まってしまうことに思う。
管理したいファイルが膨大だが、突然それに対して全部をinitしようとするのは、動かすのも大変だしバグがあった時に解決するのも面倒過ぎる。

どうなっているといいのかな、と思うに、サブフォルダから順番にinitしていって、子供のinit済みのフォルダをマージしていくようになってれば良いよなぁ。
そういうことが出来るような機能が欲しい。
当初はimportで代用すればいいかと思っていたが、どうもオペレーションが面倒で使う気が起こらない。

現状のinitは、再帰的に一気に全部作ろうとしてしまうが、
こういうのは大規模なものに対してはトラブルに弱い。
一つ一つの処理は数十秒で終わって失敗しても痛くないような単位であるべきだよな。
そっちの方がデバッグも開発もしやすいし、使う時も楽だ。
自動で動きすぎずに途中途中で手動が入る方が良い。

ハッシュを計算しない、単にファイルだけ作るuit initがあって、そのあとにinit済みの子フォルダを指定してマージしていきたい。
子供の.uitフォルダを無くして親の庇護下に入る処理を作ろう。

### 子供のrepoを取り込むコマンド名（ingestに決定）

なんて名前がいいだろう？

- 編入する transfer
- 統合する integrate
- 会員にする、傘下に置く、加盟する affilicate
- 組み込む incorporate
- (口から体内に）取り込む ingest

affiliateが意味的には近いが、incorporateの方が馴染みがあっていいかな。underとかもいい気がするが、これだとマージする感じが無いんだよなぁ。

merge child repoみたいなのが正しいんだよな。でもmcとかは絶対忘れるよなぁ。

includeとかtakeとかでもいいのだが、これだと子供の.uitが無くなる感じが出てないよなぁ。

eatとかingestとかがいいかもしれない。子供の.uitが無くなる感じもする。eatは何が起こるのかがちょっと直感的じゃないからingestにするかな。

```
$ uit ing child/folder
```

うん、いい気がする。

### 再帰的でないinitを作る

initがすべて再帰的なせいでインクリメンタルに試せない。
だから現在のフォルダだけのinitを作る。

むしろ再帰的な方を別名にしたいな。initRecursiveにしよう。コマンドライン的にはフラグを指定するだけだろうから、ソース内での関数名がやぼったくてもいいだろう。

### ingestに必要な処理を考える

- mbinfo listのマージ
- dirs下のマージ
- 子供の.uitフォルダを消す

最後はいいので前２つを考える。

**mbinfo listのマージ**

1. 子供のmbinfo listの、パスを差し替えたものを作る
2. 親のmbinfo listとマージして保存する

この二段階か。

**dirs下のマージ**

1. 親ディレクトリのdirs下に対応するディレクトリを掘る
2. dir.txtを親のdirs下に移動

dir.txtは完全に同じものでいいんだな。

書き出してみるとそんな難しくないな。